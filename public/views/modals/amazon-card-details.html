<ion-modal-view ng-controller="amazonCardDetailsController">
  <nav class="tab-bar">
    <section class="left-small">
      <a ng-click="cancel()">
        <i class="icon-arrow-left3 icon-back"></i>
        <span class="text-back">Back</span>
      </a>
    </section>
    <section class="middle tab-bar-section">
      <h1 class="title ellipsis">
        Details
      </h1>
    </section>
  </nav>

  <ion-content overflow-scroll="true">

    <div class="modal-content fix-modals-touch">
      <div class="header-modal bg-gray text-center">

        <img src="img/a_generic.jpg" alt="Amazon.com Gift Card" width="230" ng-click="refreshGiftCard()">

        <div ng-show="card.gcClaimCode">
          <div class="m10t">
            Gift Card Amount: 
            <span class="text-bold">
              {{card.cardInfo.value.amount | currency : '$ ' : 2}}
            </span>
          </div>
          <div>
            Claim code: <span class="text-bold enable_text_select">{{card.gcClaimCode}}</span>
          </div>
          <div class="m10t" ng-show="card.cardInfo.cardStatus == 'Fulfilled'">
            <button class="button black round tiny" 
                    ng-click="$root.openExternalLink('https://www.amazon.com/gc/redeem?claimCode=' + card.gcClaimCode, '_system')">
              Redeem Now
            </button>
          </div>

          <div class="size-12 m10t text-center" ng-show="card.cardInfo.cardStatus == 'Fulfilled'">
            | <a 
               ng-click="$root.openExternalLink('https://www.amazon.com/gp/css/gc/payment/view-gc-balance?claimCode=' + card.gcClaimCode, '_system')">
              Apply to Account
            </a> | 
            <a ng-click="$root.openExternalLink('http://www.amazon.com/gc-redeem')">How to Use</a> |
          </div>
        </div>
      </div>

      <div class="box-notification m20b" ng-show="error" ng-click="error = null">
        <span class="text-warning">
          {{error}}
        </span>
      </div> 

      <div class="text-center size-12" ng-show="card.status != 'SUCCESS'">
        <div ng-show="card.status == 'RESEND'">
          <div class="text-secondary m10h">
            There was a temporary/recoverable system failure that can be resolved by retrying the request
          </div>
          <button class="m10t button outline round dark-gray tiny" ng-click="refreshGiftCard()">
            Try again
          </button>
        </div>
        <div class="text-warning m10" ng-show="card.status == 'FAILURE'">
          There was a failure to the create gift card that could not be recoverable. Please, contact BitPay to refund your bitcoin
        </div>
      </div>

      <div class="size-12 white line-t p10" ng-show="card.gcClaimCode && card.cardInfo.cardStatus == 'Fulfilled'">
        <div class="text-bold m10b">To redeem your gift card, follow these steps:</div>
        <ol class="amazon-list size-12">
          <li>Visit <a ng-click="$root.openExternalLink('https://www.amazon.com/gc')">www.amazon.com/gc</a>.</li>
          <li>Click Apply to Account and enter the claim code when prompted.</li>
          <li>Gift card funds will be applied automatically to eligible orders during the checkout process.</li>
          <li>You must pay for any remaining balance on your order with another payment method.</li>
        </ol>
        <p class="size-12">Your gift card claim code may also be entered when prompted during checkout. 
        To redeem your gift card using the Amazon.com 1-Click&reg; service, first add the gift card 
        funds to Your Account.</p>
        <p class="size-12">If you have questions about redeeming your gift card, please visit 
        <a ng-click="$root.openExternalLink('https://www.amazon.com/gc-redeem')">www.amazon.com/gc-redeem</a>. 
        If you have questions regarding the BitPay offer, please contact BitPay.</p>
      </div>

      <ul class="no-bullet size-14">
        <h4 class="title">Details</h4>
        <li class="line-b p10 oh">
          <span class="text-gray">Card status</span>
          <span class="text-success right" ng-if="card.cardInfo.cardStatus == 'Fulfilled'">Fulfilled</span>
          <span class="text-secondary right" ng-if="card.cardInfo.cardStatus == 'RefundedToPurchaser'">Refunded to purchaser</span>
          <span class="text-warning right" ng-if="card.cardInfo.cardStatus == 'Expired'">Expired</span>
        </li>
        <li class="line-b p10 oh">
          <span class="text-gray">Created at</span>
          <span class="test-gray right">{{card.date * 1000 | amDateFormat:'MM/DD/YYYY HH:mm a'}}</span>
        </li>
        <li class="line-b p10 oh">
          <span class="text-gray">Creation status</span>
          <span class="text-success right" ng-if="card.status == 'SUCCESS'">Success</span>
          <span class="text-secondary right" ng-if="card.status == 'RESEND'">Resend is required</span>
          <span class="text-warning right" ng-if="card.status == 'FAILURE'">Error</span>
          <span class="text-warning right" ng-if="card.status == 'REFUND'">Refunded</span>
        </li>
        <li class="line-b p10 oh pointer" ng-click="$root.openExternalLink(card.bitpayInvoiceUrl)">
          <i class="icon-arrow-right3 size-24 right text-gray"></i>  
          <span class="text-gray">BitPay Invoice</span>
          <span class="text-gray right enable_text_select">{{card.bitpayInvoiceId}}</span>
        </li>
      </ul>

      <div class="row m20t" 
        ng-show="card.status == 'FAILURE' || card.cardInfo.cardStatus == 'RefundedToPurchaser' || card.cardInfo.cardStatus == 'Expired'">
        <div class="columns text-center">
          <p class="size-12 text-gray">
          This action will remove the gift card
          </p>
          <button class="button outline round dark-gray tiny" 
                  ng-click="remove()">
            <i class="fi-x"></i>
            Remove
          </button>
        </div>
      </div>

      <div class="row m20t" ng-show="card.status == 'SUCCESS' && card.cardInfo.cardStatus == 'Fulfilled'">
        <div class="columns text-center">
          <p class="size-12 text-gray">
            This action will cancel the gift card
          </p>
          <button class="button outline round dark-gray tiny" 
                  ng-click="cancelGiftCard()">
            <i class="fi-x"></i>
            Cancel
          </button>
        </div>
      </div>

      <div class="size-12 white p15 m20t">
        *Amazon.com Gift Cards (&quot;GCs&quot;) sold by BitPay, Inc., an authorized and independent
        reseller of Amazon.com Gift Cards. Except as required by law, GCs cannot be transferred for value or redeemed for cash.
        GCs may be used only for purchases of eligible goods at Amazon.com or certain of its affiliated websites. Purchases are
        deducted from the GC balance. To redeem or view a GC balance, visit &ldquo;Your Account&rdquo; at Amazon.com. Amazon is
        not responsible if a GC is lost, stolen, destroyed or used without permission. See 
        <a ng-click="$root.openExternalLink('https://www.amazon.com/gc-legal')">www.amazon.com/gc-legal</a> for complete terms, 
        restrictions and exceptions. For any other questions, see 
        <a ng-click="$root.openExternalLink('https://www.amazon.com/gc')">www.amazon.com/gc</a>. GCs are issued 
        by ACI Gift Cards, Inc., a Washington corporation. All Amazon &reg;, &trade; &amp; &copy; are IP of 
        Amazon.com, Inc. or its affiliates. No expiration date or service fees.
      </div>

      <div class="extra-margin-bottom"></div>
    </div>
  </ion-content>
</ion-modal-view>
