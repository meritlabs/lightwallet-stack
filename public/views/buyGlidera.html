<div 
  class="topbar-container" 
  ng-include="'views/includes/topbar.html'"
  ng-init="titleSection='Buy'; goBackToState = 'glidera'">
</div>


<div class="content glidera" ng-controller="buyGlideraController as buy">

  <div class="onGoingProcess" ng-show="buy.loading">
    <div class="onGoingProcess-content" ng-style="{'background-color':index.backgroundColor}">
    <div class="spinner">
      <div class="rect1"></div>
      <div class="rect2"></div>
      <div class="rect3"></div>
      <div class="rect4"></div>
      <div class="rect5"></div>
    </div>
    <span>{{buy.loading|translate}}</span>
    </div>
  </div>

  <div ng-show="index.glideraLimits">
    <h4 class="title m0">
      <div class="left">
        <i class="fi-info size-24 m10r"></i>
      </div>
      <div class="size-10">
        <span class="text-light" translate>Daily buy limit</span>:
        ${{index.glideraLimits.dailyBuy}} 
        (remaining ${{index.glideraLimits.dailyBuyRemaining}}) 
        <br>
        <span class="text-light" translate>Monthly buy limit</span>:
        ${{index.glideraLimits.monthlyBuy}} 
        (remaining ${{index.glideraLimits.monthlyBuyRemaining}})
      </div>
    </h4>
  </div>

  <div class="row m20t">
    <div class="columns">

      <div class="box-notification" ng-show="index.glideraLimits.transactDisabledPendingFirstTransaction">
        <span class="text-warning size-14" translate>
          This operation was disabled because you have a pending first transaction
        </span>
      </div>

      <div ng-show="!buy.show2faCodeInput && !buy.success">
        <form name="buyPriceForm" 
          ng-submit="buy.get2faCode(index.glideraToken)" novalidate>
          <label><span translate>Amount in</span> {{showAlternative ? 'USD' : 'BTC'}}</label>
          <div class="input">
            <input ng-show="!showAlternative" type="number" id="qty" 
            name="qty" ng-attr-placeholder="{{'Amount'|translate}}"
            ng-minlength="0.00000001" ng-maxlength="10000000000" 
            ng-model="qty" autocomplete="off" ng-change="buy.getBuyPrice(index.glideraToken, {'qty': qty})">
            
            <input ng-show="showAlternative" type="number" id="fiat" 
            name="fiat" ng-attr-placeholder="{{'Amount'|translate}}" 
            ng-model="fiat" autocomplete="off" ng-change="buy.getBuyPrice(index.glideraToken, {'fiat': fiat})">
            
            <a ng-show="!showAlternative" class="postfix" 
              ng-click="showAlternative = true; qty = null; buy.buyPrice = null">BTC</a>
            <a ng-show="showAlternative" class="postfix" 
              ng-click="showAlternative = false; fiat = null; buy.buyPrice = null">USD</a>

            <div class="text-center text-gray size-12 m20b" ng-show="buy.buyPrice.qty">
              Buy 
              <span ng-show="qty">${{buy.buyPrice.subtotal}} {{buy.buyPrice.currency}} in Bitcoin</span> 
              <span ng-show="fiat">{{buy.buyPrice.qty}} BTC</span> 
              at ${{buy.buyPrice.price}} {{buy.buyPrice.currency}} 
            </div>

            <input class="button black expand round" 
            ng-style="{'background-color':index.backgroundColor}"
            type="submit" value="{{'Continue'|translate}}" 
            ng-disabled="index.glideraLimits.transactDisabledPendingFirstTransaction || !buy.buyPrice.qty || buy.loading">
          </div>
        </form> 
      </div>
      <div ng-show="buy.show2faCodeInput && !buy.success">
        <p class="text-gray" translate>
        ${{buy.buyPrice.price}} {{buy.buyPrice.currency}} will be immediately withdrawn from your
        bank account. The total of {{buy.buyPrice.qty}} BTC will be purchased and deposited to your bitcoin wallet ({{index.walletName}}) in 2-4 business days.
        </p>
        <p class="text-gray" translate>
          A SMS containing a confirmation code was sent to your phone. Please, enter code below
        </p>
        <form name="buyForm" 
          ng-submit="buy.sendRequest(index.glideraToken, index.glideraPermissions, twoFaCode)" novalidate>
          <label translate>Glidera 2FA Code</label>
            <input type="number" ng-model="twoFaCode" required>
            <input class="button black expand round" 
            ng-style="{'background-color':index.backgroundColor}"
            type="submit" value="{{'Buy'|translate}}" ng-disabled="buyForm.$invalid || buy.loading">
        </form>
      </div>
      <div class="box-notification" ng-show="buy.error && !buy.success">
        <span class="text-warning size-14">
          {{buy.error|translate}}
        </span>
      </div>
      <div class="text-center" ng-show="buy.success">
        <h1 translate>Purchase initiated</h1>
        <p class="text-gray" translate>
        A transfer has been initiated from your bank account. Your bitcoins should arrive to your wallet in 4-6 business days.
        </p>

        <button class="outline dark-gray round expand"
          ng-click="$root.go('glidera')">
          OK
        </button>
      </div>
    </div>
  </div> 
</div>
<div class="extra-margin-bottom"></div>
