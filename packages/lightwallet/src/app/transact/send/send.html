<ion-header no-border>
  <ion-toolbar>
    <ion-searchbar [(ngModel)]="searchQuery" [debounce]="200" (ionChange)="parseSearch()"
                   (ionCancel)="clearSearch()"></ion-searchbar>
    <ion-buttons end *ngIf="!searchQuery">
      <button ion-button icon-only item-end (click)="openScanner()">
        <ion-icon name="qr-code" merit-icon></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>

    <div *ngIf="loadingContacts" class="loader">
        <ion-spinner></ion-spinner>
    </div>

    <div *ngIf="!loadingContacts && !hasUnlockedWallets" class="unlock-screen">
        <div class="unlock-backdrop" *ngIf="!hasUnlockedWallets"></div>

        <div class="unlock-popup">
            <div class="top-label">Before you start...</div>
            <img src="assets/img/icons/confirm.svg">
            <h2>Waiting for unlock</h2>
            <div class="bottom-label">You cannot send Merit until your wallet unlock request is confirmed</div>
        </div>

        <ion-list>
            <ion-item *ngFor="let idx of [0,1,2,3,4,5,6,7,8,9,10]" class="contact-stub">
                <ion-avatar item-start img-icon></ion-avatar>
                <h2></h2>
                <p></p>
            </ion-item>
        </ion-list>
    </div>


  <div *ngIf="!loadingContacts && searchResult  && hasUnlockedWallets" class="content">

    <div class="no-results" *ngIf="!searchResult.withMerit.length && !searchResult.noMerit.length">

      <div class="no-results-label" *ngIf="!searchResult.error">No results</div>
      <div class="no-results-label" *ngIf="searchResult.error == 'ERROR_ADDRESS_NOT_CONFIRMED'">
        Address is not confirmed yet
      </div>

      <div *ngIf="searchResult.toNewEntity">

        <button ion-button *ngIf="searchResult.toNewEntity.destination == 'address'" (click)="createContact()"
                class="send-button" color="light">
          Create New Contact
        </button>
        <button ion-button *ngIf="searchResult.toNewEntity.destination == 'address'" (click)="bindAddressToContact()"
                class="send-button" color="light">
          Bind to existing contact
        </button>
        <button ion-button padding (click)="sendToEntity(searchResult.toNewEntity)" class="send-button">
          <div *ngIf="searchResult.toNewEntity.destination == 'address'">Send To This Address</div>
          <div *ngIf="searchResult.toNewEntity.destination == 'sms'">Send SMS To This Number</div>
          <div *ngIf="searchResult.toNewEntity.destination == 'email'">Send Email To This Address</div>
        </button>
        <div class="address">{{searchQuery}}</div>
      </div>

    </div>

    <div *ngIf="!showRecent">
      <ion-list *ngIf="searchResult.withMerit.length" class="list-with-merit">
        <ion-item-divider>Friends with Merit
          <button ion-button clear item-end (click)="showRecent = true">Recent</button>
        </ion-item-divider>
        <ion-item *ngFor="let contact of searchResult.withMerit" (click)="sendToContact(contact)" class="contact">
          <contact-avatar [contact]="contact" item-start></contact-avatar>
          {{ contact.name.formatted }}
          <img src="assets/img/icons/merit.svg" color="primary" item-end>
        </ion-item>
      </ion-list>

      <ion-list *ngIf="searchResult.noMerit.length" class="list-no-merit">
        <ion-item-divider>Other Friends</ion-item-divider>
        <ion-item *ngFor="let contact of searchResult.noMerit" (click)="sendToContact(contact)" class="contact">
          <contact-avatar [contact]="contact" item-start></contact-avatar>
          {{ contact.name.formatted }}
        </ion-item>
      </ion-list>
    </div>

    <div *ngIf="showRecent">
      <ion-list class="list-recent">
        <ion-item-divider>Recent contacts
          <button ion-button clear item-end (click)="showRecent = false">All Contacts</button>
        </ion-item-divider>
        <ion-item *ngFor="let contact of searchResult.recent" (click)="sendToContact(contact)" class="contact">
          <ion-avatar item-start>
          </ion-avatar>
          {{contact.label}}
          <img src="assets/img/icons/merit.svg" color="primary" item-end *ngIf="contact.meritAddresses.length">
        </ion-item>
        <div *ngIf="!searchResult.recent.length" padding>
          No recent transactions. Send Merit to your friends to see how easy it is!
        </div>
      </ion-list>
    </div>

  </div>

</ion-content>
