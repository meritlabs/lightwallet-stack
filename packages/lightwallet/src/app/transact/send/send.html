<ion-content>

    <div class="searchbar-wrapper">
        <ion-searchbar [(ngModel)]="searchQuery" [debounce]="200" (ionChange)="parseSearch()" (ionCancel)="clearSearch()">
            Test
        </ion-searchbar>

        <button icon-only (click)="openScanner()" *ngIf="!searchQuery" class="searchbar-qr-icon">
            <img alt="" src="assets/img/icons/qr.svg" >
        </button>
    </div>


    <div *ngIf="loadingContacts">
        <ion-spinner></ion-spinner>
    </div>

    <div *ngIf="!loadingContacts">


        <ion-refresher (ionRefresh)="doRefresh($event)" (onpull)="{}" [enabled]="!loading">
            <ion-refresher-content></ion-refresher-content>
        </ion-refresher>

        <ion-item *ngIf="!searchResult.withMerit.length && !searchResult.noMerit.length">No results</ion-item>

        <ion-item *ngIf="!searchResult.withMerit.length && !searchResult.noMerit.length && searchResult.toNewEntity">

            <button ion-button *ngIf="searchResult.toNewEntity.destination == 'address'" (click)="createNewContact()">
                Create New Contact
            </button>
            <ion-item *ngIf="searchResult.toNewEntity.destination == 'address'" (click)="bindAddressToContact()">
                Bind {{search.query}} to existing contact
            </ion-item>
            <button ion-button padding (click)="sendToEntity(searchResult.toNewEntity)">
                <div *ngIf="searchResult.toNewEntity.destination == 'address'">Send To This Address</div>
                <div *ngIf="searchResult.toNewEntity.destination == 'sms'">Send SMS To This Number</div>
                <div *ngIf="searchResult.toNewEntity.destination == 'email'">Send Email To This Address</div>
            </button>
            <div class="address">{{searchQuery}}</div>
        </ion-item>


        <div *ngIf="!showRecent">
            <ion-list *ngIf="searchResult.withMerit.length" class="list-with-merit"  [virtualScroll]="searchResult.withMerit">
                <ion-list-header>Friends with Merit
                    <button ion-button clear item-end (click)="showRecent = true">Recent</button>
                </ion-list-header>
                <ion-item *virtualScroll="let contact" (click)="selectContact(contact)">
                    <ion-avatar item-start>
                        <img [src]="sanitizePhotoUrl(contact.photos[0]?.value)" *ngIf="contact.photos.length">
                        <span color="primary">{{getContactInitials(contact)}}</span>
                    </ion-avatar>
                    {{contact.name}}
                    <img src="merit.svg" color="primary" item-end>
                </ion-item>
            </ion-list>

            <ion-list *ngIf="searchResult.noMerit.length" class="list-no-merit"  [virtualScroll]="searchResult.noMerit">
                <ion-list-header>Other Friends</ion-list-header>
                <ion-item *virtualScroll="let contact" (click)="selectContact(contact)">
                    <ion-avatar item-start>
                        <img [src]="sanitizePhotoUrl(contact.photos[0]?.value)" *ngIf="contact.photos.length">
                        <span color="primary">{{getContactInitials(contact)}}</span>
                    </ion-avatar>
                    {{contact.label}}
                </ion-item>
            </ion-list>
        </div>

        <div *ngIf="showRecent">
            <ion-list  class="list-recent">
                <ion-list-header>Recent contacts
                    <button clear item-end (click)="showRecent = false">All contacts</button>
                </ion-list-header>
                <ion-item *ngFor="let contact of searchResult.recent" (click)="selectContact(contact)">
                    <ion-avatar item-start>
                    </ion-avatar>send-
                    {{contact.label}}
                    <img src="merit.svg" color="primary" item-end *ngIf="contact.meritAddresses.length">
                </ion-item>
                <ion-item *ngIf="!searchResult.recent.length">
                    No recent transactions. Send Merit to your friends to see how easy it is!
                </ion-item>
            </ion-list>
        </div>

    </div>

</ion-content>
