<ion-header no-border>
  <ion-navbar color="light">
    <ion-title>Receive Merit</ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="share()" [hidden]="!showShareButton()">
        <ion-icon color="primary" name="share"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content [class.footerCollapsed]="isFooterCollapsed" [class.locked]="!hasUnlockedWallet">

  <div *ngIf="ctrl.walletsLoading$ | async; else loaded">
      <ion-spinner></ion-spinner>
  </div>

  <ng-template #loaded>
    <div *ngIf="ctrl.hasUnlockedWallet; else noWallets">
      <div class="container" *ngIf="ctrl.qrAddress">
        <qr-code [value]="ctrl.qrAddress" [size]="220" foreground="#334"></qr-code>
      </div>

    </div>

    <ng-template #noWallets>
      <div class="unlock-screen">
        <div class="unlock-backdrop"></div>

        <div class="unlock-popup">
          <div class="top-label">Before you start...</div>
          <img src="assets/img/icons/confirm.svg">
          <h2>Waiting for invite</h2>
          <div class="bottom-label">You cannot receive Merit until you are invited.</div>
        </div>

        <div class="qr-stub">
          <img src="assets/img/icons/qr_l.svg">
        </div>

        <ion-footer>
          <ion-toolbar>
            <ion-item>
              <ion-avatar item-start img-icon>
                <img src="assets/img/icons/request-amount-gray.svg" alt="">
              </ion-avatar>
              <ion-label>
                <h2></h2>
                <p></p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-avatar item-start img-icon>
                <img src="assets/img/icons/merit-gray.svg" alt="">
              </ion-avatar>
              <ion-label>
                <h2></h2>
                <p></p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-avatar item-start img-icon>
                <img src="assets/img/icons/wallet-gray.svg" alt="">
              </ion-avatar>
              <ion-label>
                <h2></h2>
                <p></p>
              </ion-label>
            </ion-item>
          </ion-toolbar>
        </ion-footer>
      </div>
    </ng-template>
  </ng-template>

</ion-content>

<ion-footer *ngIf="ctrl.hasUnlockedWallet" text-center>

  <button #toggleButton ion-button round small outline icon-start class="footer-toggle-button" (click)="toggleFooter()">
    <ion-icon [name]="isFooterCollapsed? 'arrow-up' : 'arrow-down'"></ion-icon> {{ isFooterCollapsed? 'Show options' : 'Hide options'}}
  </button>

  <ion-toolbar>

    <div enter-to-next>
      <ion-list>
        <ion-item (click)="focusInput()">
          <ion-avatar img-icon item-start>
            <img src="assets/img/icons/request amount.svg" alt="">
          </ion-avatar>
          <ion-label stacked>
            <p>Request Amount (optional)</p>
          </ion-label>
          <ion-input #amountInput type="number" pattern="[0-9\.]" min="0" [(ngModel)]="ctrl.amount" (ionChange)="ctrl.changeAmount()" [placeholder]="'0.00 ' + ctrl.amountCurrency"></ion-input>
          <button ion-button item-end clear color="primary" (click)="toggleCurrency()">{{ ctrl.amountCurrency }}</button>
        </ion-item>

        <button ion-item detail-none text-wrap (click)="copyToClipboard(ctrl.address)" [clip]="ctrl.address">
          <ion-avatar img-icon item-start>
            <img src="assets/img/icons/merit.svg" alt="">
          </ion-avatar>
          <ion-label stacked>
            <p>Merit Address</p>
            <h2 [class.address]="!ctrl.alias">{{ctrl.alias? '@' + ctrl.alias : ctrl.address}}</h2>
          </ion-label>
        </button>

        <button ion-item detail-none (click)="ctrl.selectWallet()">
          <ion-avatar img-icon item-start>
            <img src="assets/img/icons/wallet.svg" alt="">
          </ion-avatar>
          <ion-label stacked>
            <p>Receive to</p>
            <h2>{{ ctrl.selectedWallet.name || ctrl.selectedWallet._id }}</h2>
          </ion-label>
        </button>
      </ion-list>
    </div>

  </ion-toolbar>
</ion-footer>
