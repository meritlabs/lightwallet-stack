<ion-header no-border>
  <ion-navbar color="primary">
    <ion-title>
      {{ recipient?.name?.formatted? 'Sending To: ' + recipient.name.formatted : sendMethod?.type == 'easy' ? 'MeritMoney Link' : 'Sending To: ' + (sendMethod?.alias? '@' + sendMethod?.alias : sendMethod?.value)}}
    </ion-title>
  </ion-navbar>
</ion-header>
<ion-content no-bounce>
  <div *ngIf="ctrl.receipt$ | async"></div>

  <form [formGroup]="ctrl.formData">
    <div class="big-header">
      <div class="amount-area" (click)="focusInput()">
        <div class="currency-bar">
          <div *ngIf="availableUnits?.length > 1">
            <div *ngFor="let currency of availableUnits" (click)="selectCurrency(currency)"
                 class="currency" [class.selected]="currency?.type == selectedCurrency?.type">
              {{currency.name}}
              <span class="selected-mark" [hidden]="currency?.type != selectedCurrency?.type"></span>
            </div>
          </div>
        </div>
        <div class="main-amount" enter-to-next>
          <!--<div class="amount-sm amount-converted" *ngIf="formData.amount">-->
          <!--</div>-->
          <ion-item no-lines>
            <ion-input
              #amount
              type="number"
              formControlName="amountMrt"
              placeholder="Enter amount to send"
              (keypress)="amountKeypress($event.keyCode)"
              [class]="getAmountClass()"
            ></ion-input>
          </ion-item>
          <div class="amount-sm">MRT</div>
        </div>
        <!--<div class="alternative-amount">
          {{selectedCurrency?.value?.type == 'mrt' ? fiat : amount?.mrtStr}}
        </div>-->
      </div>

      <div class="input-errors" [hidden]="!amountMrt.dirty || amountMrt.valid">
        <div [hidden]="!amountMrt.hasError('required')">
              <span class="tooltip-error">
                <span>
                  Amount is required
                </span>
              </span>
        </div>
        <div [hidden]="amountMrt.hasError('required') || !amountMrt.hasError('InvalidAmount')">
              <span class="tooltip-error">
                <span>
                  Invalid amount
                </span>
              </span>
        </div>
      </div>
    </div>

    <ion-list>
      <ion-item *ngIf="sendMethod?.type == 'easy'" [class.hasErrors]="destination.dirty && destination.invalid">
        <ion-avatar item-start img-icon>
          <img src="assets/img/icons/email.svg" alt="">
        </ion-avatar>
        <ion-label stacked>
          <p>Recipient (optional)</p>
        </ion-label>
        <ion-input placeholder="Phone number or Email address" formControlName="destination"></ion-input>
      </ion-item>
      <div class="input-errors" [hidden]="!destination.dirty || destination.valid">
        <div [hidden]="!destination.hasError('InvalidDestination')">
          Invalid email or phone number
        </div>
      </div>
      <button ion-item (click)="selectWallet()" detail-none class="wallet-selector" text-wrap>
        <ion-avatar item-start img-icon>
          <img src="assets/img/icons/wallet.svg">
        </ion-avatar>
        <ion-label *ngIf="wallet.value">
          <p>From</p>
          <h2>{{wallet.value.name}}</h2>
          <p *ngIf="wallet.value.alias">@{{wallet.alias}}</p>
          <p>{{wallet.value.balance?.spendableAmount | toMRT}}</p>
          <p *ngIf="sendMethod?.type =='easy'">Invites: {{wallet.value.availableInvites}}</p>
        </ion-label>
        <ion-icon name="ios-arrow-down" item-end></ion-icon>
      </button>
      <ion-item detail-none>
        <ion-avatar item-start img-icon>
          <img src="assets/img/icons/percent.svg">
        </ion-avatar>
        <ion-label>
          Recipient pays fee
          <button ion-button clear (click)="showFeeIncludedTooltip()" class="tooltip-button">
            <ion-icon name="ios-information-circle-outline"></ion-icon>
          </button>
        </ion-label>
        <ion-toggle formControlName="feeIncluded"></ion-toggle>
      </ion-item>

      <ion-item-group *ngIf="sendMethod?.type == 'easy'" enter-to-next>
        <ion-item>
          <ion-avatar item-start img-icon>
            <img src="assets/img/icons/unlock.svg">
          </ion-avatar>
          <ion-label stacked>Add Password (Optional)</ion-label>
          <ion-input type="text" class="password-input" formControlName="password" placeholder="Type it here"
                     autocomplete="new-password" autocorrect="off" autocapitalize="off"></ion-input>
        </ion-item>

        <ion-item [hidden]="!password?.value?.length">
          <ion-avatar item-start img-icon>
            <img src="assets/img/icons/unlock.svg">
          </ion-avatar>
          <ion-label stacked>Confirm Password</ion-label>
          <ion-input type="text" class="password-input" formControlName="confirmPassword" placeholder="Repeat password"
                     #confirmInput autocomplete="new-password" autocorrect="off" autocapitalize="off"></ion-input>
        </ion-item>
      </ion-item-group>

    </ion-list>
  </form>

  <button ion-button class="action-button" (click)="toConfirm()" [disabled]="!isSendAllowed()">
    <div *ngIf="!ctrl.receiptLoading">Send Merit</div>
    <ion-spinner *ngIf="ctrl.receiptLoading" color="light"></ion-spinner>
  </button>
</ion-content>
