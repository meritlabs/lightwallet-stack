<ion-header>
  <ion-navbar color="light">
    <ion-title *ngIf="recipient.name?.formatted">
      <h2>Recipient: {{recipient.name.formatted}}</h2>
      <p>via {{ sendMethod.alias? '@' + sendMethod.alias : sendMethod.value }}</p>
    </ion-title>
    <ion-title *ngIf="!recipient.name?.formatted">
      <h2>{{ sendMethod.type == 'easy' ? 'Easy Send to' : 'Classic Send to' }}</h2>
      <p>{{ sendMethod.alias? '@' + sendMethod.alias : sendMethod.value }}</p>
    </ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <div *ngIf="!loading">

    <div class="amount-area">

      <div class="currency-bar">
        <div *ngIf="availableUnits?.length > 1">
          <div *ngFor="let currency of availableUnits" (click)="selectCurrency(currency)"
               class="currency" [class.selected]="currency.type == selectedCurrency.type">
            {{currency.name}}
            <span class="selected-mark" [hidden]="currency.type != selectedCurrency.type"></span>
          </div>
        </div>
      </div>

      <div class="main-amount">
        <ion-item no-lines>
          <ion-input
            #amount 
            type="number"
            pattern="[0-9\.]"
            [(ngModel)]="formData.amount"
            (ngModelChange)="processAmount(formData.amount)"
            [placeholder]="'Enter sending amount'"
            (keypress)="amountKeypress($event.keyCode)" 
          ></ion-input>
        </ion-item>
      </div>
      <div class="alternative-amount">
        {{selectedCurrency.type == 'mrt' ? amount.fiatStr : amount.mrtStr}}
      </div>

      <div class="suggested-amounts">
        <button ion-button outline *ngFor="let amount of suggestedAmounts[selectedCurrency.type]"
                (click)="selectAmount(amount)">
          {{amount}}
        </button>
      </div>

    </div>

    <button ion-item (click)="selectWallet()" detail-none>
      <ion-avatar item-start img-icon>
        <img src="assets/img/icons/wallet.svg">
      </ion-avatar>
      <p>From</p>
      <h2>{{selectedWallet.name}}</h2>
      <p>{{selectedWallet.status ? selectedWallet.status.spendableBalanceStr : '0.00'}} MRT</p>
      <ion-icon name="ios-arrow-down" item-end></ion-icon>
    </button>

    <button ion-item no-lines detail-none>
      <ion-avatar item-start img-icon>
        <img src="assets/img/icons/percent.svg">
      </ion-avatar>
      <p>Fee</p>

      <h2 *ngIf="!selectedFee">
        <span *ngIf="!feeLoading">Not calculated</span>
        <ion-spinner *ngIf="feeLoading"></ion-spinner>
      </h2>
      <p *ngIf="feeCalcError">{{feeCalcError}}</p>

      <h2 *ngIf="selectedFee" style="text-transform: capitalize">{{selectedFee.description}}</h2>
      <p *ngIf="selectedFee">{{selectedFee.percent}} - ~{{selectedFee.minutes}} mins</p>
      <div item-end *ngIf="selectedFee">
        {{selectedFee.mrt}} MRT
        <ion-icon name="ios-arrow-down"></ion-icon>
      </div>
    </button>

    <ion-item>
      <ion-avatar item-start></ion-avatar>
      <ion-label>
        Recipient pays fee
        <button ion-button clear (click)="showFeeIncludedTooltip()" class="tooltip-button">
          <ion-icon name="ios-information-circle-outline"></ion-icon>
        </button>
      </ion-label>
      <ion-toggle [(ngModel)]="feeIncluded" (ionChange)="toggleFeeIncluded($event)"></ion-toggle>
    </ion-item>

    <ion-list *ngIf="sendMethod.type == 'easy'">
      <ion-item>
        <ion-avatar item-start img-icon>
          <img src="assets/img/icons/unlock.svg">
        </ion-avatar>
        <ion-label stacked>Add Password (Optional)</ion-label>
        <ion-input type="password" [(ngModel)]="formData.password" placeholder="Type it here"
                   autocomplete="off" autocorrect="off" autocapitalize="off"></ion-input>
      </ion-item>
    </ion-list>

    <ion-list *ngIf="formData.password">
      <ion-item>
        <ion-avatar item-start></ion-avatar>
        <ion-label stacked>Confirm Password</ion-label>
        <ion-input type="password" [(ngModel)]="formData.confirmPassword" placeholder="Repeat password"
                   autocomplete="off" autocorrect="off" autocapitalize="off"></ion-input>
      </ion-item>
    </ion-list>

    <!--<ion-item *ngIf="sendMethod.type == 'easy'">-->
    <!--<ion-avatar item-start img-icon>-->
    <!--<img src="assets/img/icons/timeout.svg">-->
    <!--</ion-avatar>-->
    <!--<ion-label stacked>Valid till</ion-label>-->
    <!--<ion-label>~{{formData.validTill}} ({{formData.nbBlocks}})</ion-label>-->
    <!--<ion-icon name="arrow-right" item-end></ion-icon>-->
    <!--</ion-item>-->

  </div>

  <button ion-button icon-end class="action-button" color="primary" (click)="toConfirm()" [disabled]="!isSendAllowed()">
    NEXT
    <ion-icon name="ios-arrow-forward"></ion-icon>
  </button>

</ion-content>
