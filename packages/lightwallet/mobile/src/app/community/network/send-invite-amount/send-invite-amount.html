<ion-header no-border>
  <ion-navbar color="primary">
    <ion-title>
      Creating MeritInvite link
    </ion-title>
  </ion-navbar>
</ion-header>
<ion-content no-bounce>
  <form [formGroup]="ctrl.formData" *ngIf="!ctrl.easySendUrl">
    <div class="big-header">
      <div class="amount-area" (click)="focusInput()">
        <div class="main-amount" enter-to-next>
          <ion-item no-lines>
            <ion-input
              #amount
              type="number"
              formControlName="amount"
              placeholder="Enter amount to send"
              (keypress)="amountKeypress($event.keyCode)"
              (ionFocus)="amountFocused = true"
              (ionBlur)="amountFocused = false"
            >
            </ion-input>
          </ion-item>
          <div class="amount-sm">Invite token<span *ngIf="amountInv.value >1">s</span></div>
        </div>
      </div>

      <div class="input-errors" [hidden]="!amountInv.dirty || amountInv.valid">
        <div [hidden]="!amountInv.hasError('required')">
              <span class="tooltip-error">
                <span>
                  Amount is required
                </span>
              </span>
        </div>
        <div [hidden]="amountInv.hasError('required') || !amountInv.hasError('InvalidAmount')">
              <span class="tooltip-error">
                <span>
                  Invalid amount
                </span>
              </span>
        </div>
        <div [hidden]="!amountInv.hasError('NotEnoughInvites')">
          <span class="tooltip-error">
            <span>
              You don't have enough invites
            </span>
          </span>
        </div>
      </div>
    </div>
  </form>

  <ion-list *ngIf="!ctrl.easySendUrl">
    <ion-item [class.hasErrors]="(destination.dirty && destination.invalid) || (address.dirty && address.invalid)">
      <ion-avatar item-start img-icon>
        <img src="assets/img/icons/email.svg" alt="">
      </ion-avatar>
      <ion-label stacked>
        <p>Recipient (optional)</p>
      </ion-label>
      <ion-input placeholder="Address, Alias, Phone number or Email address" [(ngModel)]="customDestination"
                 (ngModelChange)="onDestinationChange()" (ionFocus)="amountFocused = true"
                 (ionBlur)="amountFocused = false"></ion-input>
    </ion-item>
    <div class="input-errors" [hidden]="(destination.dirty && destination.invalid) || (address.dirty && address.invalid)">
      <div [hidden]="!destination.hasError('InvalidDestination')">
        Invalid email or phone number
      </div>
      <div [hidden]="!address.hasError('AddressNotFound')">
        Address not found
      </div>
    </div>
    <button ion-item (click)="selectWallet()" detail-none *ngIf="wallet.value">
      <ion-avatar item-start img-icon>
        <img src="assets/img/icons/wallet.svg">
      </ion-avatar>
      <p>From</p>
      <h2>{{wallet.value.name}}</h2>
      <p *ngIf="wallet.value.alias">@{{wallet.value.alias}}</p>
      <p>Invites: {{wallet.value.balance.spendableInvites}} {{ wallet.value.balance.pendingInvites? '(+' + wallet.value.balance.pendingInvites + ' pending)' : null }}</p>
      <ion-icon name="ios-arrow-down" item-end></ion-icon>
    </button>
  </ion-list>

  <div class="global-illustration" [hidden]="ctrl.easySendUrl">
    <img src="assets/img/icons/invite.svg" color="primary" item-end>
    <h2>Slide to create MeritInvite link</h2>
    <p>Select number of invite tokens you want to send and slide right to create an invite link. This link can be shared
      any way you want.</p>
  </div>


  <ion-card *ngIf="ctrl.easySendUrl" style="margin-top: 150px">
    <ion-card-header text-wrap>
      <p *ngIf="ctrl.easySendDelivered === undefined">
        Your MeritMoney Link is now ready to share:
      </p>
      <p *ngIf="ctrl.easySendDelivered === true">
        Your MeritMoney Link is ready and was successfully delivered to your recipient!
      </p>
      <p *ngIf="ctrl.easySendDelivered === false">
        Your MeritMoney Link is ready, however, we were not able to deliver it to your recipient. You can copy the
        link and send it to them directly:
      </p>
    </ion-card-header>
    <ion-card-content>
      <a (click)="copyToClipboard()" [clip]="ctrl.easySendUrl">{{ ctrl.easySendUrl }}</a>
    </ion-card-content>

    <ion-row>
      <ion-col>
        <button ion-button icon-left clear small (click)="copyToClipboard()" [clip]="ctrl.easySendUrl">
          <ion-icon name="clipboard"></ion-icon>
          <div>Copy</div>
        </button>
      </ion-col>
      <ion-col [hidden]="!showShareButton">
        <button ion-button icon-left clear small (click)="share()">
          <ion-icon name="share"></ion-icon>
          <div>Share</div>
        </button>
      </ion-col>
    </ion-row>
  </ion-card>


  <ion-footer [hidden]="ctrl.easySendUrl || amountFocused">
    <slide-to-action [text]="'Slide to create link'" (confirm)="send()" [disabled]="!isSendAllowed()"></slide-to-action>
  </ion-footer>


  <div class="footer" *ngIf="ctrl.easySendUrl">
    <button ion-button class="action-button" (click)="toWallets()">
      Back to wallets
    </button>
  </div>

</ion-content>
